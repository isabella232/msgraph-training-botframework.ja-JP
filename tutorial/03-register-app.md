---
ms.openlocfilehash: 9a320225c7e7e76506d73909a311fa019b1f74f3
ms.sourcegitcommit: e0d9b18d2d4cbeb4a48890f3420a47e6a90abc53
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/17/2020
ms.locfileid: "49347858"
---
<!-- markdownlint-disable MD002 MD041 -->

この演習では、Azure ポータルを使用して、新しい Bot チャネル登録と Azure AD web アプリケーション登録を作成します。

## <a name="create-a-bot-channels-registration"></a>Bot チャネル登録を作成する

1. ブラウザーを開き、 [Azure ポータル](https://portal.azure.com)に移動します。 Azure サブスクリプションに関連付けられているアカウントを使用してログインします。

1. 左上のメニューを選択し、[ **リソースの作成**] を選択します。

    ![Azure Portal メニューのスクリーンショット](images/create-resource.png)

1. [ **新規** ] ページで、[ `Bot Channel` **Bot チャネル登録**] を検索して選択します。

1. [ **Bot チャネル登録** ] ページで、[ **作成**] を選択します。

1. 必要なフィールドに入力し、[ **メッセージングエンドポイント** を空白のままにします。] **Bot ハンドル** フィールドは一意である必要があります。 さまざまな価格レベルを確認し、シナリオに適したものを選択してください。 これが学習課題である場合は、無料のオプションを選択します。

1. **Microsoft アプリ ID とパスワード** を選択し、[**新規作成**] を選択します。

1. [ **アプリ登録ポータルでアプリ ID を作成** する] を選択します。 これにより、Azure Portal の **アプリ登録** ブレードに新しいウィンドウまたはタブが開きます。

1. [ **アプリの登録** ] ブレードで、[ **新規登録**] を選択します。

1. 値を次のように設定します。

    - `Graph Calendar Bot` に **[名前]** を設定します。
    - **[サポートされているアカウントの種類]** を **[任意の組織のディレクトリ内のアカウントと個人用の Microsoft アカウント]** に設定します。
    - **[リダイレクト URI]** を空のままにします。

    ![[アプリケーションを登録する] ページのスクリーンショット](./images/aad-register-an-app.png)

1. **[登録]** を選択します。 [ **Graph Calendar Bot** ] ページで、 **アプリケーション (クライアント) ID** の値をコピーして保存します。これは、次の手順で必要になります。

    ![新しいアプリ登録のアプリケーション ID のスクリーンショット](./images/aad-application-id.png)

1. **[管理]** で **[証明書とシークレット]** を選択します。 
            **[新しいクライアント シークレット]** ボタンを選択します。 **[説明]** に値を入力して、**[有効期限]** のオプションのいずれかを選び、**[追加]** を選択します。

1. このページを離れる前に、クライアント シークレットの値をコピーします。 次の手順で必要になります。

    > [!IMPORTANT]
    > このクライアント シークレットは今後表示されないため、この段階で必ずコピーするようにしてください。 この値は、安全に保つために複数の場所に入力する必要があります。

1. ブラウザーの [Bot チャネルの登録] ウィンドウに戻り、アプリケーション ID を **Microsoft APP id** フィールドに貼り付けます。 クライアントシークレットを [ **パスワード** ] フィールドに貼り付けます。 **[OK]** を選択します。

1. [ **Bot チャネル登録** ] ページで、[ **作成**] を選択します。

1. Bot チャネル登録が作成されるのを待ちます。 作成されたら、Azure ポータルのホームページに戻り、[ **Bot サービス**] を選択します。 新しい Bot チャネル登録を選択して、そのプロパティを表示します。

## <a name="create-a-web-app-registration"></a>Web アプリの登録を作成する

1. Azure ポータルの [ **アプリの登録** ] セクションに戻ります。

1. **[新規登録]** を選択します。 **[アプリケーションを登録]** ページで、次のように値を設定します。

    - `Graph Calendar Bot Auth` に **[名前]** を設定します。
    - **[サポートされているアカウントの種類]** を **[任意の組織のディレクトリ内のアカウントと個人用の Microsoft アカウント]** に設定します。
    - **[リダイレクト URI]** で、最初のドロップダウン リストを `Web` に設定し、それから `https://token.botframework.com/.auth/web/redirect` に値を設定します。

1. **[登録]** を選択します。 [ **グラフ予定表 Bot 認証** ] ページで、 **アプリケーション (クライアント) ID** の値をコピーして保存します。これは、次の手順で必要になります。

1. **[管理]** で **[証明書とシークレット]** を選択します。 
            **[新しいクライアント シークレット]** ボタンを選択します。 **[説明]** に値を入力して、**[有効期限]** のオプションのいずれかを選び、**[追加]** を選択します。

1. このページを離れる前に、クライアント シークレットの値をコピーします。 次の手順で必要になります。

1. [ **API アクセス許可**] を選択し、[ **アクセス許可の追加**] を選択します。

1. [ **Microsoft Graph**] を選択し、[委任された **アクセス許可**] を選択します。

1. 次のアクセス許可を選択し、[ **アクセス許可の追加**] を選択します。

    - **openid**
    - **profile**
    - **Calendars.ReadWrite**
    - **MailboxSettings.Read**

    ![構成済みのアクセス許可のスクリーンショット](images/configured-permissions.png)

### <a name="about-permissions"></a>アクセス許可について

これらのアクセス許可スコープによって、bot が実行できること、およびそのユーザーがどのように使用するかを検討します。

- **openid** and **profile**: bot がユーザーにサインインして、Id トークン内の Azure AD からの基本情報を取得できるようにします。
- [**カレンダー**]: bot は、ユーザーの予定表を読み取って、ユーザーの予定表に新しいイベントを追加することができます。
- **MailboxSettings**: bot がユーザーのメールボックス設定を読み取ることができるようにします。 Bot はこれを使用して、ユーザーが選択したタイムゾーンを取得します。
- **ユーザーの読み取り**: Bot が Microsoft Graph からユーザーのプロファイルを取得することを許可します。 Bot はこれを使用して、ユーザーの名前を取得します。

## <a name="add-oauth-connection-to-the-bot"></a>Bot に OAuth 接続を追加する

1. Azure Portal で bot の Bot チャネル登録ページに移動します。 [ **Bot 管理**] の下にある [**設定**] を選択します。

1. ページの下部付近にある [ **OAuth 接続設定** ] で、[ **設定の追加**] を選択します。

1. フォームに次のように入力し、[ **保存**] を選択します。

    - **Name**: `GraphBotAuth`
    - **プロバイダー**: **Azure Active Directory v2**
    - **クライアント id**: **グラフ予定表 Bot 認証** 登録のアプリケーション id。
    - **クライアントシークレット**: **グラフの予定表 Bot 認証** 登録のクライアントシークレット。
    - **トークン交換 URL**: 空白のままにする
    - **テナント ID**: `common`
    - **範囲**: `openid profile Calendars.ReadWrite MailboxSettings.Read User.Read`

1. [ **OAuth 接続設定**] の下の **GraphBotAuth** エントリを選択します。

1. [ **テスト接続**] を選択します。 これにより、新しいブラウザーウィンドウまたはタブが開き、OAuth フローが開始されます。

1. 必要に応じて、サインインします。 要求されたアクセス許可の一覧を確認し、[ **同意** する] を選択します。

1. **' GraphBotAuth ' のテスト接続が成功** したことを確認するメッセージが表示されます。

> [!TIP]
> このページの [ **トークンのコピー** ] ボタンを選択し、トークンをに貼り付けて、 [https://jwt.ms](https://jwt.ms) トークン内のクレームを確認できます。 これは、認証エラーのトラブルシューティングに役立ちます。
